From 3df8cc4c7bba036b3109742572a1cc248d1935e9 Mon Sep 17 00:00:00 2001
From: Christophe Chapuis <chris.chapuis@gmail.com>
Date: Sat, 13 Jul 2019 13:16:44 +0000
Subject: [PATCH] configure.ac: always require libglibutil

Some tests don't build otherwise

Signed-off-by: Christophe Chapuis <chris.chapuis@gmail.com>
---
 ofono/configure.ac | 17 ++++++++---------
 1 file changed, 8 insertions(+), 9 deletions(-)

diff --git a/ofono/configure.ac b/ofono/configure.ac
index 966e7f67..c7366c89 100644
--- a/ofono/configure.ac
+++ b/ofono/configure.ac
@@ -183,17 +183,18 @@ AC_ARG_ENABLE(sailfish-rilmodem, AC_HELP_STRING([--enable-sailfish-rilmodem],
 				[enable_sailfish_rilmodem="no"])
 AM_CONDITIONAL(SAILFISH_RILMODEM, test "${enable_sailfish_rilmodem}" != "no")
 
+PKG_CHECK_MODULES(GLIBUTIL, libglibutil >= 1.0.30, dummy=yes,
+			AC_MSG_ERROR(libglibutil >= 1.0.30 is required))
+need_glibutil=yes
+
 if (test "${enable_sailfish_rilmodem}" = "yes"); then
 	PKG_CHECK_MODULES(GRILIO, libgrilio >= 1.0.25, dummy=yes,
 				AC_MSG_ERROR(libgrilio >= 1.0.25 is required))
-	PKG_CHECK_MODULES(GLIBUTIL, libglibutil >= 1.0.30, dummy=yes,
-				AC_MSG_ERROR(libglibutil >= 1.0.30 is required))
 	PKG_CHECK_MODULES(LIBMCE, libmce-glib >= 1.0.5, dummy=yes,
 				AC_MSG_ERROR(libmce-glib >= 1.0.5 is required))
 	CFLAGS="$CFLAGS $GRILIO_CFLAGS $LIBMCE_CFLAGS"
 	LIBS="$LIBS $GRILIO_LIBS $LIBMCE_LIBS"
 	enable_sailfish_manager=yes
-	need_glibutil=yes
 fi
 
 AC_ARG_ENABLE(sailfish-manager,
@@ -202,12 +203,10 @@ AC_ARG_ENABLE(sailfish-manager,
 					[enable_sailfish_manager=${enableval}])
 AM_CONDITIONAL(SAILFISH_MANAGER, test "${enable_sailfish_manager}" = "yes")
 
-if (test "${enable_sailfish_manager}" = "yes"); then
-	PKG_CHECK_MODULES(DBUS_GLIB, dbus-glib-1, dummy=yes,
-			AC_MSG_ERROR(dbus-glib is required by unit tests))
-	AC_SUBST(DBUS_GLIB_CFLAGS)
-	AC_SUBST(DBUS_GLIB_LIBS)
-fi
+PKG_CHECK_MODULES(DBUS_GLIB, dbus-glib-1, dummy=yes,
+		AC_MSG_ERROR(dbus-glib is required by unit tests))
+AC_SUBST(DBUS_GLIB_CFLAGS)
+AC_SUBST(DBUS_GLIB_LIBS)
 
 AC_ARG_ENABLE(add-remove-context, AC_HELP_STRING([--disable-add-remove-context],
 		[don't allow to add or remove connection context over D-Bus]), [
-- 
2.17.0

